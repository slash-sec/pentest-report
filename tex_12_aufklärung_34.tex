\section{Aufklärung des Netzes 172.16.34.0/24}
\label{sec:discover_172_16_34_0}

Da mit Übernahme des \textbf{win}-Hosts mit der IP-Adresse \texttt{172.16.34.42} und Subnetzmaske \texttt{255.255.255.0} ein für den Angreifer neues Subnetz bekannt wurde, wird dieses in diesem Kapitel aufgeklärt.

Zunächst wurde mit dem Befehl \texttt{apt install nmap} das Netzwerkscanning-Tool \texttt{nmap} auf dem Host \texttt{win}, mit der Shell-Session aus dem vorherigen Kapitel nachinstalliert. Textauszug \ref{lst:final_network_discovery} zeigt das Ergebnis des Netzwerkscans des Netzes \texttt{172.16.34.0/24}.


\lstset{language=bash,caption={Nmap-Scan des \texttt{172.16.34.0/24}-Netzes}, label=lst:final_network_discovery}
\begin{lstlisting}[frame=single, firstnumber=1, stepnumber=1,]
root@win:/# nmap -R 172.16.34.0/24 -PS20-100,443,445,8000,8080,8088,8089 -p 1-10000 -T4 --script=vuln -sV -O -oX nmap_scan

Starting Nmap 7.60 ( https://nmap.org ) at 2022-03-01 19:53 UTC

Nmap scan report for mbint.int.mb-reps.cool.datcom.prv (172.16.34.1)
Host is up (0.00031s latency).
Not shown: 9999 filtered ports
PORT   STATE SERVICE VERSION
53/tcp open  domain
MAC Address: 0E:23:25:FB:52:E7 (Unknown)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
No OS matches for host
Network Distance: 1 hop

Nmap scan report for BigCindy.int.mb-reps.cool.datcom.prv (172.16.34.142)
Host is up (0.00030s latency).
Not shown: 9999 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.7 (protocol 2.0)
MAC Address: 2E:12:99:3F:F1:19 (Unknown)
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.60%E=4%D=3/1%OT=22%CT=1%CU=40694%PV=Y%DS=1%DC=D%G=Y%M=2E1299%TM
OS:=621E7D5B%P=x86_64-pc-linux-gnu)SEQ(SP=101%GCD=1%ISR=108%TI=Z%CI=Z%TS=A)
OS:SEQ(SP=101%GCD=1%ISR=108%TI=Z%CI=Z%II=I%TS=A)OPS(O1=M5B4ST11NW7%O2=M5B4S
OS:T11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=
OS:FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=
OS:M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)
OS:T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S
OS:+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=
OS:Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G
OS:%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD=S)

Network Distance: 1 hop

Nmap scan report for Mickey.int.mb-reps.cool.datcom.prv (172.16.34.224)
Host is up (0.00026s latency).
Not shown: 9999 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)
MAC Address: 0E:63:B1:74:FB:14 (Unknown)
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.60%E=4%D=3/1%OT=22%CT=1%CU=43285%PV=Y%DS=1%DC=D%G=Y%M=0E63B1%TM
OS:=621E7D5B%P=x86_64-pc-linux-gnu)SEQ(SP=101%GCD=1%ISR=105%TI=Z%CI=Z%TS=A)
OS:SEQ(SP=101%GCD=1%ISR=105%TI=Z%CI=Z%II=I%TS=A)OPS(O1=M5B4ST11NW7%O2=M5B4S
OS:T11NW7%O3=M5B4NNT11NW7%O4=M5B4ST11NW7%O5=M5B4ST11NW7%O6=M5B4ST11)WIN(W1=
OS:FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=
OS:M5B4NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)
OS:T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S
OS:+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=
OS:Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G
OS:%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD=S)

Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Nmap scan report for Esperanza.int.mb-reps.cool.datcom.prv (172.16.34.242)
Host is up (0.00035s latency).
Not shown: 9997 filtered ports
PORT     STATE SERVICE       VERSION
135/tcp  open  msrpc         Microsoft Windows RPC
445/tcp  open  microsoft-ds  Microsoft Windows Server 2008 R2 - 2012 microsoft-ds
3389/tcp open  ms-wbt-server Microsoft Terminal Service
| rdp-vuln-ms12-020: 
|   VULNERABLE:
|   MS12-020 Remote Desktop Protocol Denial Of Service Vulnerability
|     State: VULNERABLE
|     IDs:  CVE:CVE-2012-0152
|     Risk factor: Medium  CVSSv2: 4.3 (MEDIUM) (AV:N/AC:M/Au:N/C:N/I:N/A:P)
|           Remote Desktop Protocol vulnerability that could allow remote attackers to cause a denial of service.
|           
|     Disclosure date: 2012-03-13
|     References:
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0152
|       http://technet.microsoft.com/en-us/security/bulletin/ms12-020
|   
|   MS12-020 Remote Desktop Protocol Remote Code Execution Vulnerability
|     State: VULNERABLE
|     IDs:  CVE:CVE-2012-0002
|     Risk factor: High  CVSSv2: 9.3 (HIGH) (AV:N/AC:M/Au:N/C:C/I:C/A:C)
|           Remote Desktop Protocol vulnerability that could allow remote attackers to execute arbitrary code on the targeted system.
|           
|     Disclosure date: 2012-03-13
|     References:
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-0002
|_      http://technet.microsoft.com/en-us/security/bulletin/ms12-020
|_ssl-ccs-injection: No reply from server (TIMEOUT)
|_sslv2-drown: 
MAC Address: 36:7B:49:68:33:68 (Unknown)
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose|specialized|phone
Running: Microsoft Windows 2008|8.1|7|Phone|Vista
OS CPE: cpe:/o:microsoft:windows_server_2008::beta3 cpe:/o:microsoft:windows_server_2008 cpe:/o:microsoft:windows_8.1 cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows cpe:/o:microsoft:windows_vista::- cpe:/o:microsoft:windows_vista::sp1
OS details: Microsoft Windows Server 2008 or 2008 Beta 3, Microsoft Windows Server 2008 R2 or Windows 8.1, Microsoft Windows Embedded Standard 7, Microsoft Windows 8.1 R1, Microsoft Windows Phone 7.5 or 8.0, Microsoft Windows Vista SP0 or SP1, Windows Server 2008 SP1, or Windows 7, Microsoft Windows Vista SP2, Windows 7 SP1, or Windows Server 2008
Network Distance: 1 hop
Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows

Host script results:
|_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED
|_smb-vuln-ms10-054: false
|_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED

Nmap scan report for Win.int.mb-reps.cool.datcom.prv (172.16.34.42)
Host is up (0.0000060s latency).
Not shown: 9997 closed ports
PORT     STATE SERVICE     VERSION
21/tcp   open  ftp         ProFTPD 1.3.3c
| ftp-proftpd-backdoor: 
|   This installation has been backdoored.
|   Command: id
|_  Results: uid=0(root) gid=0(root) groups=0(root),65534(nogroup)
|_sslv2-drown: 
22/tcp   open  ssh         OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
1524/tcp open  ingreslock?
| fingerprint-strings: 
|   FourOhFourRequest, GetRequest: 
|     -i: line 1: GET: command not found
|     line 2: $'
|     command not found
|   GenericLines: 
|     -i: line 1: $'
|     command not found
|     line 2: $'
|     command not found
|   HTTPOptions, RTSPRequest: 
|     -i: line 1: OPTIONS: command not found
|     line 2: $'
|     command not found
|   Help: 
|     -i: line 1: $'HELP
|     command not found
|   Kerberos: 
|     -i: line 1: $'qj201n0201k241
|     05242
|     01': command not found
|   LDAPSearchReq: 
|     -i: line 1: $'0204-
|     01ac204$
|     04': command not found
|     line 2: $'
|     01': command not found
|   LPDString: 
|     -i: line 1: $'
|     01default': command not found
|   TLSSessionReq: 
|     -i: line 1: 
|     random1random2random3random4
|_    such file or directory
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port1524-TCP:V=7.60%I=7%D=3/1%Time=621E7D68%P=x86_64-pc-linux-gnu%r(Gen
SF:ericLines,4A,"-i:\x20line\x201:\x20\$'\\r':\x20command\x20not\x20found\
SF:n-i:\x20line\x202:\x20\$'\\r':\x20command\x20not\x20found\n")%r(GetRequ
SF:est,48,"-i:\x20line\x201:\x20GET:\x20command\x20not\x20found\n-i:\x20li
SF:ne\x202:\x20\$'\\r':\x20command\x20not\x20found\n")%r(HTTPOptions,4C,"-
SF:i:\x20line\x201:\x20OPTIONS:\x20command\x20not\x20found\n-i:\x20line\x2
SF:02:\x20\$'\\r':\x20command\x20not\x20found\n")%r(RTSPRequest,4C,"-i:\x2
SF:0line\x201:\x20OPTIONS:\x20command\x20not\x20found\n-i:\x20line\x202:\x
SF:20\$'\\r':\x20command\x20not\x20found\n")%r(Help,29,"-i:\x20line\x201:\
SF:x20\$'HELP\\r':\x20command\x20not\x20found\n")%r(TLSSessionReq,51,"-i:\
SF:x20line\x201:\x20\x16\x03i\x01e\x03\x03U\x1c\xa7\xe4random1random2rando
SF:m3random4\x0c/:\x20No\x20such\x20file\x20or\x20directory\n")%r(Kerberos
SF:,54,"-i:\x20line\x201:\x20\$'qj\\201n0\\201k\\241\\003\\002\\001\\005\\
SF:242\\003\\002\\001':\x20command\x20not\x20found\n")%r(FourOhFourRequest
SF:,48,"-i:\x20line\x201:\x20GET:\x20command\x20not\x20found\n-i:\x20line\
SF:x202:\x20\$'\\r':\x20command\x20not\x20found\n")%r(LPDString,2E,"-i:\x2
SF:0line\x201:\x20\$'\\001default':\x20command\x20not\x20found\n")%r(LDAPS
SF:earchReq,64,"-i:\x20line\x201:\x20\$'0\\204-\\002\\001\\ac\\204\$\\004'
SF::\x20command\x20not\x20found\n-i:\x20line\x202:\x20\$'\\001':\x20comman
SF:d\x20not\x20found\n");
Device type: general purpose
Running: Linux 2.6.X
OS CPE: cpe:/o:linux:linux_kernel:2.6.32
OS details: Linux 2.6.32
Network Distance: 0 hops
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 256 IP addresses (5 hosts up) scanned in 1062.10 seconds
\end{lstlisting} 

Innerhalb des gescannten IP-Netzes konnten zur Domäne \texttt{int.mb-reps.cool.datcom.prv} die folgenden dazugehörigen Hosts identifiziert werden:
\begin{itemize}
\item mbint
\item BigCindy
\item Mickey
\item Esperanza
\item (Win)
\end{itemize}

In den nachfolgenden Kapitel wird die Schwachstellenbewertung dieser einzelnen Hosts vorgenommen.
